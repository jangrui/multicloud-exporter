# S3 对象存储指标映射配置
#
# 本配置文件定义了跨云厂商的 S3 对象存储指标统一映射规则。
# 支持阿里云 OSS、腾讯云 COS、AWS S3、华为云 OBS 四家云厂商。
#
# 配置结构说明：
#
# 1. prefix: 统一指标前缀（所有云厂商的指标都会映射到此前缀）
#    例如：s3_storage_usage_bytes, s3_requests_get
#
# 2. namespaces: 云厂商命名空间映射
#    格式：<云厂商标识>: <原生命名空间>
#    - aliyun: acs_oss_dashboard  # 阿里云 OSS
#    - tencent: QCE/COS           # 腾讯云 COS
#    - aws: AWS/S3                # AWS S3
#    - huawei: SYS.OBS            # 华为云 OBS
#
# 3. canonical: 规范化指标定义
#    每个规范化指标包含：
#    - description: 指标描述（包含推荐采集周期、统计口径、输出格式）
#    - <云厂商标识>: 云厂商特定配置
#      - metric: 原生指标名称
#      - dimensions: 维度列表（可选）
#      - unit: 单位（可选）
#      - scale: 缩放因子（可选，默认 1）
#
# 如何添加新的云厂商：
#
# 假设要添加 Google Cloud Storage (GCS)：
#
# 1. 在 namespaces 中添加：
#    google: GCS
#
# 2. 在需要支持的 canonical 指标下添加 google 配置：
#    storage_usage_bytes:
#      description: "存储空间使用量"
#      google:
#        metric: storage_total_bytes
#        unit: Bytes
#        scale: 1
#
# 3. 无需修改任何 Go 代码，系统会自动识别并注册新云厂商的指标映射
#
# 注意事项：
# - 不是所有云厂商都需要支持所有指标，可以只定义部分指标
# - scale 字段用于单位转换，例如腾讯云存储容量以 MB 为单位，需要 scale: 1048576 转换为 Bytes
# - dimensions 字段定义指标的维度，不同云厂商的维度可能不同

prefix: s3
namespaces:
  aliyun: acs_oss_dashboard
  tencent: QCE/COS
  aws: AWS/S3
  huawei: SYS.OBS

canonical:
  # ========================================
  # 全映射指标（4 家云厂商）
  # ========================================
  requests_get:
    description: "GET 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: GetObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    tencent:
      metric: GetRequests
      dimensions:
        - bucket
      unit: count
      scale: 1
    aws:
      metric: GetRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
    huawei:
      metric: get_request_count
      dimensions:
        - bucket_name
      unit: count
      scale: 1
  requests_head:
    description: "HEAD 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: HeadObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    tencent:
      metric: HeadRequests
      dimensions:
        - bucket
      unit: count
      scale: 1
    aws:
      metric: HeadRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
  requests_put:
    description: "PUT 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: PutObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    tencent:
      metric: PutRequests
      dimensions:
        - bucket
      unit: count
      scale: 1
    aws:
      metric: PutRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
    huawei:
      metric: put_request_count
      dimensions:
        - bucket_name
      unit: count
      scale: 1
  requests_total:
    description: "总请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: TotalRequestCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    tencent:
      metric: TotalRequests
      dimensions:
        - bucket
      unit: count
      scale: 1
    aws:
      metric: AllRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
    huawei:
      metric: request_count_per_second
      dimensions:
        - bucket_name
      unit: count/s
      scale: 1
  storage_usage_bytes:
    description: "存储空间使用量"
    aliyun:
      metric: UserStorage
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
    tencent:
      metric: StdStorage
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576
    aws:
      metric: BucketSizeBytes
      dimensions:
        - BucketName
        - StorageType
      unit: Bytes
      scale: 1
    huawei:
      metric: capacity_total
      dimensions:
        - bucket_name
      unit: Bytes
      scale: 1
  traffic_internet_rx_bytes:
    description: "公网入流量 (上传)"
    aliyun:
      metric: InternetRecv
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
    tencent:
      metric: InternetTrafficUp # Upload to Cloud
      dimensions:
        - bucket
      unit: Bytes
      scale: 1
    aws:
      metric: BytesUploaded
      dimensions:
        - BucketName
        - FilterId
      unit: Bytes
      scale: 1
    huawei:
      metric: upload_bytes_extranet
      dimensions:
        - bucket_name
      unit: Bytes
      scale: 1
  traffic_internet_tx_bytes:
    description: "公网出流量 (下载)"
    aliyun:
      metric: InternetSend
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
    tencent:
      metric: InternetTrafficDown # Download from Cloud
      dimensions:
        - bucket
      unit: Bytes
      scale: 1
    aws:
      metric: BytesDownloaded
      dimensions:
        - BucketName
        - FilterId
      unit: Bytes
      scale: 1
    huawei:
      metric: download_bytes_extranet
      dimensions:
        - bucket_name
      unit: Bytes
      scale: 1

  # ========================================
  # 部分映射指标（3 家云厂商）
  # ========================================
  availability_pct:
    description: "可用性/成功率"
    aliyun:
      metric: Availability
      dimensions:
        - userId
        - BucketName
      unit: percent
      scale: 1
    tencent:
      metric: RequestsSuccessRate
      dimensions:
        - bucket
      unit: percent
      scale: 1
    huawei:
      metric: request_success_rate
      dimensions:
        - bucket_name
      unit: percent
      scale: 1
  response_server_error_count:
    description: "服务端错误数"
    aliyun:
      metric: ServerErrorCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    tencent:
      metric: 5xxResponse
      dimensions:
        - bucket
      unit: count
      scale: 1
    aws:
      metric: 5xxErrors
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1

  # ========================================
  # 部分映射指标（2 家云厂商）
  # ========================================
  latency_e2e_get_ms:
    description: "GET 端到端延迟"
    aliyun:
      metric: GetObjectE2eLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
    huawei:
      metric: download_total_request_latency
      dimensions:
        - bucket_name
      unit: ms
      scale: 1
  latency_first_byte_ms:
    description: "首字节延迟"
    tencent:
      metric: FirstByteDelay
      dimensions:
        - bucket
      unit: ms
    aws:
      metric: FirstByteLatency
      dimensions:
        - BucketName
        - FilterId
      unit: ms
    huawei:
      metric: first_byte_latency
      dimensions:
        - bucket_name
      unit: ms
      scale: 1
  traffic_intranet_rx_bytes:
    description: "内网入流量 (上传)"
    aliyun:
      metric: IntranetRecv
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
    tencent:
      metric: InternalTrafficUp
      dimensions:
        - bucket
      unit: Bytes
      scale: 1
  traffic_intranet_tx_bytes:
    description: "内网出流量 (下载)"
    aliyun:
      metric: IntranetSend
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
    tencent:
      metric: InternalTrafficDown
      dimensions:
        - bucket
      unit: Bytes
      scale: 1

  # ========================================
  # 单独指标（阿里云专用）
  # ========================================
  authorization_error_count:
    description: "授权错误请求数（403 等）"
    aliyun:
      metric: AuthorizationErrorCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
  authorization_error_rate_pct:
    description: "授权错误占比（占总请求百分比）"
    aliyun:
      metric: AuthorizationErrorRate
      dimensions:
        - userId
        - BucketName
      unit: percent
      scale: 1
  bandwidth_fetch_bps:
    description: "远程拉取带宽（Fetch）"
    tencent:
      metric: FetchBandwidth
      dimensions:
        - bucket
      unit: bps
  bandwidth_intranet_rx_bps:
    description: "内网入带宽"
    aliyun:
      metric: IntranetRecvBandwidth
      dimensions:
        - userId
        - BucketName
      unit: bit/s
  bandwidth_intranet_tx_bps:
    description: "内网出带宽"
    aliyun:
      metric: IntranetSendBandwidth
      dimensions:
        - userId
        - BucketName
      unit: bit/s
  bandwidth_internet_rx_bps:
    description: "公网入带宽"
    aliyun:
      metric: InternetRecvBandwidth
      dimensions:
        - userId
        - BucketName
      unit: bit/s
  bandwidth_internet_tx_bps:
    description: "公网出带宽"
    aliyun:
      metric: InternetSendBandwidth
      dimensions:
        - userId
        - BucketName
      unit: bit/s
  cache_origin_recv_bytes:
    description: "缓存回源入流量 (Bytes)"
    aliyun:
      metric: CacheOriginRecv
      dimensions:
        - userId
        - instanceId
        - BucketName
      unit: Bytes
  cache_origin_send_bytes:
    description: "缓存回源出流量 (Bytes)"
    aliyun:
      metric: CacheOriginSend
      dimensions:
        - userId
        - instanceId
        - BucketName
      unit: Bytes
  cache_recv_bytes:
    description: "缓存入流量 (Bytes)"
    aliyun:
      metric: CacheRecv
      dimensions:
        - userId
        - instanceId
        - BucketName
      unit: Bytes
  cache_send_bytes:
    description: "缓存出流量 (Bytes)"
    aliyun:
      metric: CacheSend
      dimensions:
        - userId
        - instanceId
        - BucketName
      unit: Bytes
  client_timeout_error_count:
    description: "客户端超时错误请求数（如 408）"
    aliyun:
      metric: ClientTimeoutErrorCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
  client_timeout_error_rate_pct:
    description: "客户端超时错误占比（占总请求百分比）"
    aliyun:
      metric: ClientTimeoutErrorRate
      dimensions:
        - userId
        - BucketName
      unit: percent
      scale: 1
  latency_e2e_append_ms:
    description: "AppendObject 端到端延迟"
    aliyun:
      metric: AppendObjectE2eLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_e2e_copy_ms:
    description: "CopyObject 端到端延迟"
    aliyun:
      metric: CopyObjectE2eLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_e2e_put_ms:
    description: "PUT 端到端延迟"
    aliyun:
      metric: PutObjectE2eLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_server_append_ms:
    description: "AppendObject 服务端延迟"
    aliyun:
      metric: AppendObjectServerLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_server_copy_ms:
    description: "CopyObject 服务端延迟"
    aliyun:
      metric: CopyObjectServerLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_server_get_ms:
    description: "GET 服务端延迟"
    aliyun:
      metric: GetObjectServerLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  latency_server_put_ms:
    description: "PUT 服务端延迟"
    aliyun:
      metric: PutObjectServerLatency
      dimensions:
        - userId
        - BucketName
      unit: ms
  requests_append:
    description: "AppendObject 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: AppendObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
  requests_copy:
    description: "CopyObject 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: CopyObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
  requests_delete:
    description: "DELETE 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aliyun:
      metric: DeleteObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
  traffic_cdn_rx_bytes:
    description: "CDN 回源入流量"
    aliyun:
      metric: CdnRecv
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
  traffic_cdn_tx_bytes:
    description: "CDN 回源出流量"
    aliyun:
      metric: CdnSend
      dimensions:
        - userId
        - BucketName
      unit: Bytes
      scale: 1
  traffic_replication_rx_bytes:
    description: "跨区域复制入流量 (Bytes)"
    aliyun:
      metric: MeteringSyncRX
      dimensions:
        - userId
        - BucketName
        - region
        - storageType
      unit: Bytes
  traffic_replication_tx_bytes:
    description: "跨区域复制出流量 (Bytes)"
    aliyun:
      metric: MeteringSyncTX
      dimensions:
        - userId
        - BucketName
        - region
        - storageType
      unit: Bytes

  # ========================================
  # 单独指标（腾讯云专用）
  # ========================================
  response_2xx_count:
    description: "2xx 响应数"
    tencent:
      metric: 2xxResponse
      dimensions:
        - bucket
      unit: count
  response_2xx_rate_pct:
    description: "2xx 响应占比"
    tencent:
      metric: 2xxResponseRate
      dimensions:
        - bucket
      unit: percent
      scale: 1
  response_3xx_count:
    description: "3xx 响应数"
    tencent:
      metric: 3xxResponse
      dimensions:
        - bucket
      unit: count
  response_3xx_rate_pct:
    description: "3xx 响应占比"
    tencent:
      metric: 3xxResponseRate
      dimensions:
        - bucket
      unit: percent
      scale: 1
  response_4xx_count:
    description: "4xx 响应数"
    tencent:
      metric: 4xxResponse
      dimensions:
        - bucket
      unit: count
  response_4xx_rate_pct:
    description: "4xx 响应占比"
    tencent:
      metric: 4xxResponseRate
      dimensions:
        - bucket
      unit: percent
      scale: 1
  response_5xx_rate_pct:
    description: "5xx 响应占比"
    tencent:
      metric: 5xxResponseRate
      dimensions:
        - bucket
      unit: percent
      scale: 1
  storage_archive_bytes:
    description: "归档存储用量 (Bytes)"
    tencent:
      metric: DeepArcStorage
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576
  storage_archive_multipart_bytes:
    description: "归档碎片容量 (Bytes)"
    tencent:
      metric: DeepArcMultipartStorage
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576
  storage_archive_multipart_count:
    description: "归档碎片文件数"
    tencent:
      metric: DeepArcMultipartNumber
      dimensions:
        - bucket
      unit: count
  storage_archive_object_count:
    description: "归档对象数量"
    tencent:
      metric: DeepArcObjectNumber
      dimensions:
        - bucket
      unit: count
  storage_archive_read_requests:
    description: "归档读请求数"
    tencent:
      metric: DeepArcReadRequests
      dimensions:
        - bucket
      unit: count
  storage_archive_retrieval_bulk_bytes:
    description: "归档批量取回量 (Bytes)"
    tencent:
      metric: DeepArcBulkRetrieval
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576
  storage_archive_retrieval_standard_bytes:
    description: "归档标准取回量 (Bytes)"
    tencent:
      metric: DeepArcStandardRetrieval
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576
  storage_archive_write_requests:
    description: "归档写请求数"
    tencent:
      metric: DeepArcWriteRequests
      dimensions:
        - bucket
      unit: count
  storage_ia_bytes:
    description: "低频存储用量 (Bytes)"
    tencent:
      metric: SiaStorage
      dimensions:
        - bucket
      unit: Bytes
      scale: 1048576

  traffic_replication_bytes:
    description: "跨区域复制流量 (Bytes)"
    tencent:
      metric: CrossRegionReplicationTraffic
      dimensions:
        - bucket
      unit: Bytes
  requests_copy_qps:
    description: "PutObjectCopy 请求 QPS"
    tencent:
      metric: PutObjectCopyRequestsPs
      dimensions:
        - bucket
      unit: count/s
  requests_delete_multi_qps:
    description: "DeleteMultipleObjects 请求 QPS"
    tencent:
      metric: DeleteMultiObjRequestsPs
      dimensions:
        - bucket
      unit: count/s
  requests_delete_qps:
    description: "DELETE 请求 QPS"
    tencent:
      metric: DeleteObjectRequestsPs
      dimensions:
        - bucket
      unit: count/s

  # ========================================
  # 单独指标（AWS 专用）
  # ========================================
  4xx_errors:
    description: "4xx 错误数"
    aws:
      metric: 4xxErrors
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
  delete_requests:
    description: "DELETE 请求数"
    aws:
      metric: DeleteRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
  latency_total_request_ms:
    description: "总请求延迟"
    aws:
      metric: TotalRequestLatency
      dimensions:
        - BucketName
        - FilterId
      unit: ms
      scale: 1
  number_of_objects:
    description: "对象数量"
    aliyun:
      metric: ObjectCount
      dimensions:
        - userId
        - BucketName
      unit: count
      scale: 1
    aws:
      metric: NumberOfObjects
      dimensions:
        - BucketName
        - StorageType
      unit: count
      scale: 1
  requests_list:
    description: "LIST 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aws:
      metric: ListRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
  requests_post:
    description: "POST 请求数（推荐周期：60s；统计口径：Sum；Exporter 输出：count/s）"
    aws:
      metric: PostRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
  replication_bytes_pending:
    description: "待复制字节数"
    aws:
      metric: ReplicationBytesPendingReplication
      dimensions:
        - BucketName
        - ReplicationRuleId
      unit: Bytes
      scale: 1
  replication_latency:
    description: "复制延迟"
    aws:
      metric: ReplicationLatency
      dimensions:
        - BucketName
        - ReplicationRuleId
      unit: seconds
      scale: 1
  replication_operations_failed:
    description: "复制失败操作数"
    aws:
      metric: ReplicationOperationsFailed
      dimensions:
        - BucketName
        - ReplicationRuleId
      unit: count
      scale: 1
  replication_operations_not_attempted:
    description: "未尝试复制的操作数"
    aws:
      metric: ReplicationOperationsNotAttempted
      dimensions:
        - BucketName
        - ReplicationRuleId
      unit: count
      scale: 1
  replication_operations_pending:
    description: "待复制操作数"
    aws:
      metric: ReplicationOperationsPending
      dimensions:
        - BucketName
        - ReplicationRuleId
        - StorageType
      unit: count
      scale: 1
  replication_operations_total_latency:
    description: "复制操作总延迟"
    aws:
      metric: ReplicationOperationsTotalLatency
      dimensions:
        - BucketName
        - ReplicationRuleId
      unit: seconds
      scale: 1
  select_data_returned_bytes:
    description: "SELECT 返回字节数"
    aws:
      metric: SelectDataReturned
      dimensions:
        - BucketName
        - FilterId
      unit: Bytes
      scale: 1
  select_data_scanned_bytes:
    description: "SELECT 扫描字节数"
    aws:
      metric: SelectDataScanned
      dimensions:
        - BucketName
        - FilterId
      unit: Bytes
      scale: 1
  select_requests:
    description: "SELECT 请求数"
    aws:
      metric: SelectRequests
      dimensions:
        - BucketName
        - FilterId
      unit: count
      scale: 1
