# 统一 CLB 指标映射关系（Aliyun / Tencent）
# 说明：canonical 指代统一后的 `clb_*` 名称；各云平台原始指标在 providers 下声明，并给出单位与查询层的缩放建议。
# 排序整理：2025-12-15；修改者：@jangrui；规则：按连接/流量/包速率/丢包/状态码/健康/利用率等类别分组展示（仅调整可读性，不改变键与字段）

prefix: clb
namespaces:
  aliyun: acs_slb_dashboard
  tencent: QCE/LB
  aws: AWS/ELB

canonical:
  traffic_rx_bps:
    description: "入网流量 (实例级)"
    aliyun:
      metric: InstanceTrafficRX
      dimensions:
        - userId
        - instanceId
      unit: bit/s
      scale: 1
    tencent:
      metric: VIntraffic
      dimensions: []
      unit: Mbps
      scale: 1000000
    # AWS CLB doesn't have direct RX/TX bytes metrics exposed easily like ALB/NLB.
    # It has RequestCount but not bandwidth.
    # EstimatedProcessedBytes might be available but it's not standard.
    # We'll skip bandwidth for AWS CLB or use custom metrics if available.

  traffic_tx_bps:
    description: "出网流量 (实例级)"
    aliyun:
      metric: InstanceTrafficTX
      dimensions:
        - userId
        - instanceId
      unit: bit/s
      scale: 1
    tencent:
      metric: VOuttraffic
      dimensions: []
      unit: Mbps
      scale: 1000000

  packet_rx:
    description: "入网包速率"
    aliyun:
      metric: InstancePacketRX
      dimensions:
        - userId
        - instanceId
      unit: count/s
      scale: 1
    tencent:
      metric: VInpkg
      dimensions: []
      unit: count/s
      scale: 1

  packet_tx:
    description: "出网包速率"
    aliyun:
      metric: InstancePacketTX
      dimensions:
        - userId
        - instanceId
      unit: count/s
      scale: 1
    tencent:
      metric: VOutpkg
      dimensions: []
      unit: count/s
      scale: 1

  drop_packet_rx:
    description: "入网丢包速率"
    aliyun:
      metric: InstanceDropPacketRX
      dimensions:
        - userId
        - instanceId
      unit: count/s
      scale: 1
    tencent:
      metric: Vipindroppkts
      dimensions:
        - eip
      unit: pps
      scale: 1

  drop_packet_tx:
    description: "出网丢包速率"
    aliyun:
      metric: InstanceDropPacketTX
      dimensions:
        - userId
        - instanceId
      unit: count/s
      scale: 1
    tencent:
      metric: Vipoutdroppkts
      dimensions:
        - eip
      unit: pps
      scale: 1

  drop_traffic_rx_bps:
    description: "入网丢弃流量 (实例级)"
    aliyun:
      metric: InstanceDropTrafficRX
      dimensions:
        - userId
        - instanceId
      unit: bit/s
      scale: 1

  drop_traffic_tx_bps:
    description: "出网丢弃流量 (实例级)"
    aliyun:
      metric: InstanceDropTrafficTX
      dimensions:
        - userId
        - instanceId
      unit: bit/s
      scale: 1

  traffic_rx_utilization_pct:
    description: "入网带宽利用率"
    aliyun:
      metric: InstanceTrafficRXUtilization
      dimensions:
        - userId
        - instanceId
      unit: '%'
      scale: 1
    tencent:
      metric: IntrafficVipRatio
      dimensions:
        - eip
      unit: '%'
      scale: 1

  traffic_tx_utilization_pct:
    description: "出网带宽利用率"
    aliyun:
      metric: InstanceTrafficTXUtilization
      dimensions:
        - userId
        - instanceId
      unit: '%'
      scale: 1
    tencent:
      metric: OuttrafficVipRatio
      dimensions:
        - eip
      unit: '%'
      scale: 1

  vip_new_connection:
    description: "VIP 新建连接数 (腾讯云特有)"
    tencent:
      metric: VNewConn
      dimensions: []
      unit: count/s
      scale: 1

  new_connection:
    description: "新建连接数"
    aliyun:
      metric: NewConnection
      dimensions:
        - userId
        - instanceId
        - port
      unit: count
      scale: 1
    tencent:
      metric: PvvNewConn
      dimensions: []
      unit: count/s
      scale: 1

  active_connection:
    description: "活跃连接数"
    aliyun:
      metric: ActiveConnection
      dimensions:
        - userId
        - instanceId
        - port
      unit: count
      scale: 1
    tencent:
      metric: VConnum
      dimensions: []
      unit: count
      scale: 1

  drop_connection:
    description: "丢弃连接数"
    aliyun:
      metric: DropConnection
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s
      scale: 1

  # AWS CLB doesn't have direct RX/TX bytes metrics exposed easily like ALB/NLB.


  qps:
    description: "每秒请求数 (L7)"
    aliyun:
      metric: Qps
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s
    aws:
      metric: RequestCount
      dimensions:
        - Service
      unit: count # Sum over period.

  rt:
    description: "响应时间 (L7)"
    aliyun:
      metric: Rt
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: ms
    aws:
      metric: Latency
      dimensions: []
      unit: s
      scale: 1000

  status_code_2xx:
    description: "HTTP 2XX 状态码数量"
    aliyun:
      metric: StatusCode2xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s

  status_code_3xx:
    description: "HTTP 3XX 状态码数量"
    aliyun:
      metric: StatusCode3xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s

  status_code_4xx:
    description: "HTTP 4XX 状态码数量"
    aliyun:
      metric: StatusCode4xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s

  status_code_5xx:
    description: "HTTP 5XX 状态码数量"
    aliyun:
      metric: StatusCode5xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s

  unhealthy_server_count:
    description: "异常后端服务数"
    aliyun:
      metric: UnhealthyServerCount
      dimensions:
        - userId
        - instanceId
        - port
        - vip
      unit: count
    aws:
      metric: UnHealthyHostCount
      dimensions:
        - AvailabilityZone
        - LoadBalancerName
      unit: count

  healthy_server_count:
    description: "健康后端服务数"
    aliyun:
      metric: HeathyServerCount
      dimensions:
        - userId
        - instanceId
        - port
        - vip
      unit: count
    aws:
      metric: HealthyHostCount
      dimensions:
        - Namespace
      unit: count

  instance_qps:
    description: "实例每秒请求数 (L7)"
    aliyun:
      metric: InstanceQps
      dimensions:
        - userId
        - instanceId
      unit: count/s

  instance_rt:
    description: "实例响应时间 (L7)"
    aliyun:
      metric: InstanceRt
      dimensions:
        - userId
        - instanceId
      unit: ms

  instance_status_code_2xx:
    description: "实例级 HTTP 2XX 状态码数量"
    aliyun:
      metric: InstanceStatusCode2xx
      dimensions:
        - userId
        - instanceId
      unit: count/s

  instance_status_code_3xx:
    description: "实例级 HTTP 3XX 状态码数量"
    aliyun:
      metric: InstanceStatusCode3xx
      dimensions:
        - userId
        - instanceId
      unit: count/s

  instance_status_code_4xx:
    description: "实例级 HTTP 4XX 状态码数量"
    aliyun:
      metric: InstanceStatusCode4xx
      dimensions:
        - userId
        - instanceId
      unit: count/s

  instance_status_code_5xx:
    description: "实例级 HTTP 5XX 状态码数量"
    aliyun:
      metric: InstanceStatusCode5xx
      dimensions:
        - userId
        - instanceId
      unit: count/s

  upstream_code_4xx:
    description: "上游 HTTP 4XX 状态码数量"
    aliyun:
      metric: UpstreamCode4xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s

  upstream_code_5xx:
    description: "上游 HTTP 5XX 状态码数量"
    aliyun:
      metric: UpstreamCode5xx
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: count/s
  instance_active_connection:
    description: "实例活跃连接数"
    aliyun:
      metric: InstanceActiveConnection
      dimensions:
        - userId
        - instanceId
      unit: count
  instance_drop_connection:
    description: "实例丢弃连接数"
    aliyun:
      metric: InstanceDropConnection
      dimensions:
        - userId
        - instanceId
      unit: count/s
  instance_inactive_connection:
    description: "实例非活跃连接数"
    aliyun:
      metric: InstanceInactiveConnection
      dimensions:
        - userId
        - instanceId
      unit: count
  instance_max_connection:
    description: "实例最大连接数"
    aliyun:
      metric: InstanceMaxConnection
      dimensions:
        - userId
        - instanceId
      unit: count
  instance_max_connection_utilization:
    description: "实例最大连接数利用率"
    aliyun:
      metric: InstanceMaxConnectionUtilization
      dimensions:
        - userId
        - instanceId
      unit: ratio
  instance_new_connection:
    description: "实例新建连接数"
    aliyun:
      metric: InstanceNewConnection
      dimensions:
        - userId
        - instanceId
      unit: count/s
  instance_new_connection_utilization:
    description: "实例新建连接数利用率"
    aliyun:
      metric: InstanceNewConnectionUtilization
      dimensions:
        - userId
        - instanceId
      unit: ratio
  instance_qps_utilization:
    description: "实例每秒请求数利用率"
    aliyun:
      metric: InstanceQpsUtilization
      dimensions:
        - userId
        - instanceId
      unit: ratio
  unhealthy_server_count_with_rule:
    description: "按规则聚合的异常后端数"
    aliyun:
      metric: UnhealthyServerCountWithRule
      dimensions:
        - userId
        - instanceId
        - port
        - vip
        - domain
        - url
      unit: count
  upstream_rt:
    description: "上游响应时间"
    aliyun:
      metric: UpstreamRt
      dimensions:
        - userId
        - instanceId
        - port
        - protocol
      unit: ms
  pvv_outpkg:
    description: "腾讯 CLB 私有实例出网包速率"
    tencent:
      metric: PvvOutpkg
      unit: count/s
  pvv_outtraffic:
    description: "腾讯 CLB 私有实例出网流量"
    tencent:
      metric: PvvOuttraffic
      unit: bps
  rrv_connum:
    description: "腾讯 CLB 共享实例活跃连接数"
    tencent:
      metric: RrvConnum
      unit: count
  rrv_inactive_conn:
    description: "腾讯 CLB 共享实例非活跃连接数"
    tencent:
      metric: RrvInactiveConn
      unit: count
  rrv_inpkg:
    description: "腾讯 CLB 共享实例入网包速率"
    tencent:
      metric: RrvInpkg
      unit: count/s
  rrv_intraffic:
    description: "腾讯 CLB 共享实例入网流量"
    tencent:
      metric: RrvIntraffic
      unit: bps
  rrv_new_conn:
    description: "腾讯 CLB 共享实例新建连接数"
    tencent:
      metric: RrvNewConn
      unit: count/s
  rrv_outpkg:
    description: "腾讯 CLB 共享实例出网包速率"
    tencent:
      metric: RrvOutpkg
      unit: count/s
  rrv_outtraffic:
    description: "腾讯 CLB 共享实例出网流量"
    tencent:
      metric: RrvOuttraffic
      unit: bps
  rv_connum:
    description: "腾讯 CLB VIP 活跃连接数"
    tencent:
      metric: RvConnum
      unit: count
  rv_inactive_conn:
    description: "腾讯 CLB VIP 非活跃连接数"
    tencent:
      metric: RvInactiveConn
      unit: count
  rv_inpkg:
    description: "腾讯 CLB VIP 入网包速率"
    tencent:
      metric: RvInpkg
      unit: count/s
  rv_intraffic:
    description: "腾讯 CLB VIP 入网流量"
    tencent:
      metric: RvIntraffic
      unit: bps
  rv_new_conn:
    description: "腾讯 CLB VIP 新建连接数"
    tencent:
      metric: RvNewConn
      unit: count/s
  rv_outpkg:
    description: "腾讯 CLB VIP 出网包速率"
    tencent:
      metric: RvOutpkg
      unit: count/s
  rv_outtraffic:
    description: "腾讯 CLB VIP 出网流量"
    tencent:
      metric: RvOuttraffic
      unit: bps
